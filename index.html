<html>
  <head>
    <title></title>
    <script src="jquery.js"></script>
    <script src="sockjs.js"></script>
    <script src="vertxbus.js"></script>

    <script>
      $(function() {
        var eb = new vertx.EventBus('http://localhost:9090/eventbus');

        eb.onopen = function() {
          $('#status').click(function() {
            var username = $('#username').val()
            eb.send("register-user", username, function(incoming) {
              $('#login').html('<h1> . : ' + username + ' - Connected : . </h1>');

              $.each(incoming.users, function() {
                $('#users').append('<li>' + this + '</li>');
              });

              eb.registerHandler('new-presence', function(message) {
                $('#users').append('<li>' + message + '</li>');
              });

            });
          });

          $('#users').on('click', 'li', function() {
            $('#control').css('display', 'block');
          });
        }
      });
    </script>
  </head>

  <body>
    <div id="login">
      <input type="text" placeholder="Username" id="username">
      <button id="status"> . : Connect : . </button>
    </div>

    <div>
      <ul id="users">
      </ul>

      <div id="control" style="display: none;">
        <input type="text" placeholder="Message" id="message">
        <button id="status"> . : Send : . </button>
      </div>
    </div>
  </body>

</html>
